<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>CMSA</title>
	<link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/font-awesome/css/font-awesome.min.css">
	<link rel="stylesheet" href="assets/css/form-elements.css">
   	<link rel="stylesheet" href="assets/css/style.css">
   	<link rel="stylesheet" href="assets/css/summernote.min.css">
   	<link rel="stylesheet" type="text/css" href="jquery.fileTree-1.01/jqueryFileTree.css">
</head>
<body>
	<div class="container-fluid">
	<div class="row">
		<div class="col-md-12">
			<nav class="navbar navbar-default" role="navigation">
				<div class="navbar-header">
					 
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
						 <span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
					</button> <a class="navbar-brand" href="#">Brand</a>
				</div>
				
				<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
					<ul class="nav navbar-nav">
						<li class="active">
							<a href="#">Link</a>
						</li>
						<li>
							<a href="#">Link</a>
						</li>
						<li class="dropdown">
							 <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown<strong class="caret"></strong></a>
							<ul class="dropdown-menu">
								<li>
									<a href="#">Action</a>
								</li>
								<li>
									<a href="#">Another action</a>
								</li>
								<li>
									<a href="#">Something else here</a>
								</li>
								<li class="divider">
								</li>
								<li>
									<a href="#">Separated link</a>
								</li>
								<li class="divider">
								</li>
								<li>
									<a href="#">One more separated link</a>
								</li>
							</ul>
						</li>
					</ul>
					<form class="navbar-form navbar-left" role="search">
						<div class="form-group">
							<input type="text" class="form-control" />
						</div> 
						<button type="submit" class="btn btn-default">
							Submit
						</button>
					</form>
					<ul class="nav navbar-nav navbar-right">
						<li>
							<a href="#">Bienvenido</a>
						</li>
						<li class="dropdown">
							 <a href="#" class="dropdown-toggle" data-toggle="dropdown">--nombre--<strong class="caret"></strong></a>
							<ul class="dropdown-menu">
								<li>
									<a href="ini.php?op=salir">Salir</a>
								</li>
							</ul>
						</li>
					</ul>
				</div>
				
			</nav>
			<div class="row">
				<div class="col-md-4">
				</div>
				<div class="col-md-8">
				</div>
			</div>
		</div>
	</div>
</div>

    <div class="container-fluid">

        <div class="row">

            <div class="col-md-3">            
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h3 class="panel-title">
                        Estructura del sitio
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalPage">
                          <span class="glyphicon glyphicon-file" aria-hidden="true"></span>&nbsp;
                          Nueva P&aacute;gina
                        </button>
                    </h3>
                  </div>
                  <div class="panel-body" id="container_id">

                  </div>
                 </div>
            </div>

            <div class="col-md-9">
                <div class="row">
                    <div class="panel panel-info">
                        <div class="panel-heading">
                            <h3 class="panel-title">
                                Vista previa / Edici√≥n de p&aacute;gina
                                <button type="button" class="btn btn-success" onClick="guardar_pagina();">
                                  <span class="glyphicon glyphicon-globe" aria-hidden="true"></span>&nbsp;
                                  Publicar P&aacute;gina
                                </button>
                            </h3>
                        </div>
                        <div class="panel-body" id="vistaprevia">

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /.container -->

    <div class="container">

        <hr>

        <!-- Footer -->
        <footer>
            <div class="row">
                <div class="col-lg-12">
                    <p>Copyright &copy; Progra IV | 02-2016</p>
                </div>
            </div>
        </footer>

    </div>
    <!-- /.container -->

    <!-- Modal -->
	<div class="modal fade" id="modalPage" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="myModalLabel">Crear nueva p&aacute;gina</h4>
	      </div>
	      <div class="modal-body">
	        <form class="form-horizontal" id="formNuevaPagina">
			  <div class="form-group">
			    <label for="nbpagina" class="col-sm-2 control-label">P&aacute;gina</label>
			    <div class="col-sm-10">
			      <input type="text" class="form-control" id="nbpagina" name="nbpagina" placeholder="Pagina1.html">
			    </div>
			  </div>
			  <div class="form-group">
			    <label for="plantilla" class="col-sm-2 control-label">Plantilla</label>
			    <div class="col-sm-10">
			      <select class="form-control" id="plantilla" name="plantilla">
				    <option value="mobile.html">mobile.html</option>
                    <option value="recetario.html">recetario.html</option>
				    <option value="plantilla2.html">plantillaN.html</option>
				 </select>
			    </div>
			  </div>
			  
			</form>
			<div id="respuesta" class="alert alert-success"></div>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-primary" onClick="crear_pagina();">Crear</button>
	        <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
	        
	      </div>
	    </div>
	  </div>
	</div>
    
    <div class="modal fade bs-example-modal-sm" id="mensaje" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
	  <div class="modal-dialog modal-sm">
	    <div class="modal-content">
	      <p id="rpage" class="alert alert-info"></p>
	      <button type="button" class="btn btn-info btn-xs" data-dismiss="modal">Cerrar</button>
	    </div>
	  </div>
	</div>  
<!-- Javascript -->
        <script src="assets/js/jquery-1.11.1.min.js"></script>
        <script src="assets/bootstrap/js/bootstrap.min.js"></script>
        <script src="assets/js/jquery.backstretch.min.js"></script>
        <script src="assets/js/scripts.js"></script>
         <script src="assets/js/summernote.min.js"></script>
        <script src="assets/bootstrap/js/sha512.js"></script>
        <script src="jquery.fileTree-1.01/jqueryFileTree.js"></script>
<script>        	

		    $(document).ready( function() {views();});

		    function views()
		    {
		        $('#container_id').fileTree({
		        root: '../',
		        script: 'jqueryFileTree.php',
		        expandSpeed: 1000,
		        collapseSpeed: 1000,
		        multiFolder: false
		        }, function(file) {
		        console.log(file);
		        });	
		    }

		function crear_pagina()
    {
        $.ajax({    
        url : 'lib.php?acc=crearPagina', 
        data : $('#formNuevaPagina').serialize(),   
        type : 'post',
        success : function(data) {
                if(data==1)
                {
                    $('#respuesta').html('P&aacute;gina creada correctamente!');

                    setTimeout(function(){location.href='ini.php';$('#modalPage').modal('hide');},3000);
                }
                else
                {
                    $('#respuesta').html('Error al crear la p&aacute;gina!'); 
                }
            }
        }); 
    }

      function edit(archivo)
    {
        $.ajax({    
        url : 'lib.php?acc=editarPagina', 
        data: {pagina:archivo},
        success : function(data) {
            $('#vistaprevia').html(data);
        }
        }).done(function(){
            $('#edit-contenido').summernote();	 
        }); 
    }

    function guardar_pagina()
    {
        $.ajax({    
        url : 'lib.php?acc=guardarPagina',
        type: 'post', 
        data: {codigo:$('#edit-contenido').code()},
        success : function(data) {
            $('#mensaje').modal('show');
            $('#rpage').html(data);
        }
        });
    }
</script>

</body>
</html>